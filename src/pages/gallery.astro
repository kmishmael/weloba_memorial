---
import galleryImagesData from "../assets/data/gallery.json"
import OrnamentalDivider from "../components/OrnamentalDivider.astro"
import VintageCard from "../components/VintageCard.astro"
import { Image } from "astro:assets"
import Layout from "../layouts/Layout.astro"

const galleryImages = galleryImagesData.gallery.sort((a, b) => b.order_index - a.order_index) || []

const galleryImagesGlobs = import.meta.glob<{ default: ImageMetadata }>(
  "/src/assets/gallery/*.{jpeg,jpg,png,gif,webp}"
)

const galleryImagesWithMetadata = galleryImages.map((image) => {
  const imageImport = galleryImagesGlobs[`/src/assets/gallery/${image.image_url}`]
  return {
    ...image,
    metadata: imageImport(),
  }
})
---

<Layout>
  <div class="memorial-gradient min-h-screen px-4 py-8 sm:px-6 sm:py-12 lg:px-8">
    <div class="mx-auto max-w-7xl">
      <div class="mb-8 text-center sm:mb-12">
        <h1 class="mb-3 text-3xl font-bold text-stone-800 sm:mb-4 sm:text-4xl">Gallery</h1>
        <OrnamentalDivider className="mb-8" />
        <p class="mx-auto max-w-2xl px-2 text-base text-stone-600 sm:text-xl">
          A collection of precious moments and memories that capture the essence of Joseph's
          beautiful life
        </p>
      </div>

      <div
        id="my-gallery"
        class="pswp-gallery gallery grid grid-cols-1 gap-4 sm:grid-cols-2 sm:gap-6 lg:grid-cols-3"
      >
        {
          galleryImagesWithMetadata.length > 0 ? (
            galleryImagesWithMetadata.map(async (image, index) => (
              <a
                href={(await image.metadata).default.src}
                data-cropped="true"
                data-pswp-width={(await image.metadata).default.width}
                data-pswp-height={(await image.metadata).default.height}
                class="gallery-item group relative"
              >
                <VintageCard className="transform overflow-hidden transition-all duration-300 hover:-translate-y-1 hover:shadow-xl">
                  <div class="p-0">
                    <div class="relative">
                      <Image
                        src={image.metadata}
                        alt={image.alt_text || "Gallery image"}
                        loading={index < 9 ? "eager" : "lazy"}
                        densities={[1.5, 2]}
                        width={400}
                        height={320}
                        format="avif"
                        class="h-[320px] w-full object-cover"
                      />
                    </div>
                    <div class="pt-3 sm:pt-4">
                      <p class="text-center text-sm leading-relaxed text-stone-600">
                        {image.caption || ""}
                      </p>
                    </div>
                  </div>
                </VintageCard>
              </a>
            ))
          ) : (
            <div class="col-span-full py-12 text-center">
              <p class="text-stone-600">Gallery images will be added soon.</p>
            </div>
          )
        }
      </div>

      <div class="mt-12 text-center sm:mt-16">
        <div class="mx-auto max-w-2xl rounded-lg bg-stone-50 p-6 sm:p-8">
          <h3 class="mb-3 text-lg font-semibold text-stone-800 sm:mb-4 sm:text-xl">
            Share Your Photos
          </h3>
          <p class="mb-3 text-sm text-stone-600 sm:mb-4 sm:text-base">
            Do you have photos of Joseph that you'd like to share? We'd love to add them to this
            gallery.
          </p>
          <p class="text-xs text-stone-500 sm:text-sm">
            Please contact the family to contribute photos and memories.
          </p>
        </div>
      </div>
    </div>
  </div>

  <script>
    import "../lib/loadGallery.ts"
  </script>
</Layout>
